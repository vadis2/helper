# Create .env.testing
1. Copy .env
2. Delete application key
3. Create DB for testing: metras3-test
4. DB part must be edited
5. Close DB empty in all demo tests

```` 
// use Illuminate\Foundation\Testing\RefreshDatabase;
```` 

# Create application key manually (!)
````
pa key:generate
````

# Edit config/database.php
Add in Connections:
````
'testing' => [
    'driver'    => 'mysql',
    'host'      => env('DB_HOST', '127.0.0.1'),
    'port'      => env('DB_PORT', '3306'),
    'database'  => env('DB_DATABASE', 'forge'),
    'username'  => env('DB_USERNAME', 'forge'),
    'password'  => env('DB_PASSWORD', ''),
    'charset'   => 'utf8mb4',
    'collation' => 'utf8mb4_unicode_ci',
    'prefix'    => '',
    'strict'    => true,
    'engine'    => null,
],
````
# Edit .env.testing: DB part
````
DB_CONNECTION=testing
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=metras3-test
DB_USERNAME=root
DB_PASSWORD=456v123
````
## Edit phpunit.xml

## Change TestCase.php
````
public function tearDown()
    : void
    {
        parent::tearDown(); // TODO: Change the autogenerated stub

        Schema::dropIfExists('user_roles');
        Schema::dropIfExists('method_roles');
        Schema::dropIfExists('roles');
        Schema::dropIfExists('users');
    }
````
## Create seeds/TestsSeeder.php (seed collector)
````
<?php

use Illuminate\Database\Seeder;

/**
 * Seeder for tests
 *
 * @category Seed
 * @package  WNY
 * @author   Volodymyr Vadiasov <vadiasov.volodymyr@gmail.com>
 * @license  https://opensource.org/licenses/CDDL-1.0 CDDL-1.0
 * @link     Seed
 */
class TestsSeeder extends Seeder
{
    /**
     * Run the database seeds.
     *
     * @return void
     */
    public function run()
    {
        $this->call(TestUserSeeder::class);
        $this->call(TestRoleSeeder::class);
    }
}
````
### Create directory seeds/test_seeders with seeders
Name seeders like TestUserSeeder.php to be different with working seeders.

## Delete all DB-test tables 

## Start test file from:
````
<?php

namespace Tests\Feature\API\V1;

use Illuminate\Foundation\Testing\DatabaseMigrations;
use Tests\TestCase;

class UserControllerTest extends TestCase
{
    use DatabaseMigrations;

    public function setUp()
    : void
    {
        parent::setUp(); // TODO: Change the autogenerated stub

        $this->artisan('db:seed --class=TestsSeeder');
    }

    /**
     * A basic unit test example.
     *
     * @return void
     */
    public function testExample()
    {
        $this->assertTrue(true);
    }

    public function testMe()
    {
        $response = $this->post('api/v1/auth/login', [
            'email'    => 'super@admin.com',
            'password' => '12345678'
        ]);

        $response->assertStatus(200);

//        $responseJSON = json_decode($response->getContent(), true);
//        $token        = $responseJSON['token'];
//
//        $this->get('api/auth/me?token=' . $token, [])->assertJson([
//            'name'  => 'Test',
//            'email' => 'test1@email.com'
//        ])->isOk();
    }
}

````

## Start DB test with 
````
public function testMe()
    {
        $response = $this->post('api/v1/auth/login', [
            'email'    => 'super@admin.com',
            'password' => '12345678'
        ]);

        $response->assertStatus(200);

//        $responseJSON = json_decode($response->getContent(), true);
//        $token        = $responseJSON['token'];
//
//        $this->get('api/auth/me?token=' . $token, [])->assertJson([
//            'name'  => 'Test',
//            'email' => 'test1@email.com'
//        ])->isOk();
    }
````

